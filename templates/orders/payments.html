{% extends 'base.html' %}
{% load static %}
{% block content %}
    <section class="section-content padding-y bg">
    <div class="container">

    <!-- ============================ COMPONENT 1 ================================= -->
    
    <div class="row">
        <h4>Review your order and make payment</h4>
        <aside class="col-lg-8">

        <div class="card">
            <h5 class="card-header">Billing Address</h5>
            <div class="card-body">
                <p class="card-text mb-0">{{ order.full_name }}</p>
                <p class="card-text mb-0">{{ order.full_address }}</p>
                <p class="card-text mb-0">{{ order.city_state }}</p>
                <p class="card-text mb-0">{{ order.country }}</p>
                <p class="card-text mb-0">Phone: {{ order.phone }}</p>

                {% if order.order_note %}
                <b>Order Note:</b>
                <p class="card-text mb-0">{{ order.order_note }}</p>
                {% endif %}
            </div>
        </div>


        <div class="card">
            <h5 class="card-header">Review Products</h5>
            <div class="card-body">
                <p class="card-text">
                    <table class="table table-borderless table-shopping-cart">
                    <thead class="text-muted">
                    <tr class="small text-uppercase">
                    <th scope="col">Product</th>
                    <th scope="col" width="120">Quantity</th>
                    <th scope="col" width="120">Price</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for cart_item in cart_items %}
                    <tr>
                        <td>
                            <figure class="itemside align-items-center">
                                <div class="aside"><img src="{{ cart_item.product.product_images.url }}" class="img-sm"></div>
                                <figcaption class="info">
                                    <a href="{{ cart_item.product.get_url }}" class="title text-dark">{{ cart_item.product.product_name }}</a>
                                    <p class="text-muted small">
                                        {% if cart_item.variation.all %}
                                            {% for item in cart_item.variation.all %}
                                                {{ item.variation_category | capfirst }} : {{ item.variation_value | capfirst }} <br>
                                            {% endfor %}
                                        {% endif %}
                                    </p>
                                </figcaption>
                            </figure>
                        </td>
                        <td> 
                            <!-- col.// -->
                                    <label for="">{{ cart_item.quantity }}</label>
                        <td> 
                            <div class="price-wrap"> 
                                <var class="price">₹ {{ cart_item.sub_total }}</var> 
                                <small class="text-muted">₹ {{ cart_item.product.price }}/qty</small> 
                            </div> <!-- price-wrap .// -->
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    </table>
                    <a href="{% url 'cart' %}">Want to change something?</a>

                </p>
            </div>
        </div>

            </aside> <!-- col.// -->
            <aside class="col-lg-4">

                <div class="card">
                <div class="card-body">
                    <dl class="dlist-align">
                    <dt>Price:</dt>
                    <dd class="text-right">₹ {{ total }}</dd>
                    </dl>
                    <dl class="dlist-align">
                    <dt>Shipping Charges & Taxes:</dt>
                    <dd class="text-right">₹ {{ tax }}</dd>
                    </dl>
                    <dl class="dlist-align">
                    <dt>Total:</dt>
                    <dd class="text-right text-dark b"><strong>₹ {{ grand_total }}</strong></dd>
                    </dl>
                    <hr>
                    <button id="rzp-button1" class="btn-primary btn text-center">Pay</button>
                <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
                <script>
                var options = {
                    "key": "{{ razorpay_key }}",
                    "amount": "{{ amount|floatformat:0 }}00",
                    "currency": "INR",
                    "name": "PLANTAE",
                    "description": "Order Payment",
                    "order_id": "{{ order_id }}",
                    "callback_url": "{% url 'razorpay_callback' %}",  // You'll define this view
                    "prefill": {
                        "name": "{{ order.full_name }}",
                        "email": "{{ order.email }}",
                        "contact": "{{ order.phone }}"
                    },
                    "theme": {
                        "color": "#28a745"
                    }
                };
                var rzp1 = new Razorpay(options);
                document.getElementById('rzp-button1').onclick = function(e){
                    rzp1.open();
                    e.preventDefault();
                }
                </script>

                </div> <!-- card-body.// -->
                </div> <!-- card.// -->

        </aside> <!-- col.// -->


        </div> <!-- row.// -->
    <!-- ============================ COMPONENT 1 END .// ================================= -->

    </div> <!-- container .//  -->
    </section>
    <!-- ========================= SECTION CONTENT END// ========================= -->
    </body>
    </html>
{% endblock %}